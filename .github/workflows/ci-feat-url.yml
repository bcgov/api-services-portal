name: Add URL to Feature PRs

on:
  pull_request:
    branches: 
      - dev

jobs:
  comment:
    runs-on: ubuntu-latest
    steps:
      - name: Set KEBAB_CASE_BRANCH
        run: |
          # Convert github.head_ref to kebab case
          kebab_case=$(echo "${{ github.head_ref }}" | tr '[:upper:]' '[:lower:]' | tr -cs 'a-zA-Z0-9' '-')
          echo "::set-output name=KEBAB_CASE_BRANCH::${kebab_case}"
        id: set-deploy-id

      - name: Check the KEBAB_CASE_BRANCH output
        run: echo "The DEPLOY_ID is ${{ steps.set-deploy-id.outputs.KEBAB_CASE_BRANCH }}"

      - name: PR Description
        if: startsWith(github.head_ref, 'feature/') == true
        uses: bcgov-nr/action-pr-description-add@v1.1.1
        with:
          add_markdown: |
            ---
            ðŸš€ Feature branch deployment: https://api-services-portal-${{ steps.set-deploy-id.outputs.KEBAB_CASE_BRANCH }}.apps.silver.devops.gov.bc.ca
